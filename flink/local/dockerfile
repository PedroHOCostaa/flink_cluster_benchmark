FROM flink:1.19.1-java11

USER root
RUN apt-get update
RUN apt-get install -y --no-install-recommends python3 python3-pip
RUN apt-get install -y --no-install-recommends openjdk-11-jdk-headless
RUN pip3 install apache-flink==1.19.1
RUN apt-get clean
RUN rm -rf /var/lib/apt/lists/*

# Adiciona o conector Kafka
ADD https://repo1.maven.org/maven2/org/apache/flink/flink-connector-kafka/3.3.0-1.19/flink-connector-kafka-3.3.0-1.19.jar /opt/flink/lib/

# Volta para o usuário padrão do Flink.
USER flink

ENV PYFLINK_PYTHON=/usr/bin/python3